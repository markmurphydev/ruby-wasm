<!--
Template for single-page Wasm load & run.
Template format is `%{var_name}`

Strategy from:
https://stackoverflow.com/questions/52582367/a-single-file-webassembly-html-demo
-->
<script>
    const imports = {
        i64: { toRef: (n) => n },
        arr: {
            new: () => [],
            push: (arr, x) => arr.push(x)
        },
    }
    function compile_run_wasm() {
        const wasm_base64 = "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bRANZml4bnVtX3RvX2k2NBENYm94bnVtX3RvX2k2NBIOaW50ZWdlcl90b19pNjQTD2luX2ZpeG51bV9yYW5nZRQNaTMyX3RvX2ZpeG51bRUNaTY0X3RvX2ZpeG51bRYNaTY0X3RvX2JveG51bRcOaTY0X3RvX2ludGVnZXIYA2FkZBkDc3ViGgd0b19ib29sGwlmcm9tX2Jvb2wcBm5lZ2F0ZR0DYW5kHgJvch8CbHQgAmd0IQVlcV9lcSIJYXJyX3RvX2pzIw11bml0eXBlX3RvX2pzAuwDHwQCAARzZWxmAQRhcmdzBQIABHNlbGYBBGFyZ3MGAgAEc2VsZgEEYXJncwgFAAFhAQFiAgNpZHgDBGFfY2gEBGJfY2gJBgAFYWxpc3QBBG5hbWUCA2lkeAMEcGFpcgQDa2V5BQN2YWwKBgAIcmVjZWl2ZXIBB21lc3NhZ2UCBGFyZ3MDDHJlY2VpdmVyX29iagQGcGFyZW50BQZtZXRob2QLAQABbgwBAAFuDQEAAW4OBAADdmFsAQliaXRfd2lkdGgCDHRvcF9iaXRfbWFzawMRbWlzc2luZ19iaXRzX21hc2sPAQABbhAEAAFuAQVuX2kzMgIWbl9pMzJfbm9fZml4bnVtX21hcmtlcgMRbl9pMzJfc2lnbl9leHRlbmQRAQABbhIBAAFuEwIAAW4BBW5faTMyFAEAAW4VAQABbhYBAAFuFwEAAW4YBQADbGhzAQNyaHMCB2xoc192YWwDB3Joc192YWwEA3JlcxkFAANsaHMBA3JocwIHbGhzX3ZhbAMHcmhzX3ZhbAQDcmVzGgEAAWIbAQABYhwBAAFuHQIAAWEBAWIeAgABYQEBYh8CAAFhAQFiIAIAAWEBAWIhAgABYQEBYiIFAANhcnIBBmFycl9qcwIDaWR4AwN2YWwEBnZhbF9qcyMBAAF4AyADCAEBA2ZvcgkBAANmb3IiAgAIZXhpdF9mb3IBA2ZvcgSDAQoAA3N0cgEGYm94bnVtAgNvYmoDBm1ldGhvZAQFY2xhc3MFC2Fycl91bml0eXBlBhFhbGlzdF9zdHJfdW5pdHlwZQcWYWxpc3Rfc3RyX3VuaXR5cGVfcGFpcggQYWxpc3Rfc3RyX21ldGhvZAkVYWxpc3Rfc3RyX21ldGhvZF9wYWlyB6EBDQAEbWFpbgEKZW1wdHlfYXJncwIKc3RyX01vZHVsZQMJc3RyX0NsYXNzBA9zdHJfQmFzaWNPYmplY3QFCnN0cl9PYmplY3QGB3N0cl9uZXcHCXN0cl9jbGFzcwgIc3RyX25hbWUJDGNsYXNzX01vZHVsZQoLY2xhc3NfQ2xhc3MLEWNsYXNzX0Jhc2ljT2JqZWN0DAxjbGFzc19PYmplY3Q=";
        const wasm_buffer = Uint8Array.from(atob(wasm_base64), c => c.charCodeAt(0)).buffer;
        WebAssembly.compile(wasm_buffer).then(wasm => {
            const wasm_instance = new WebAssembly.Instance(wasm, imports);
            const output = wasm_instance.exports["__ruby_top_level_function"]();
            console.log(output);
        });
    }
</script>
<button onclick="compile_run_wasm()">Compile and run Wasm</button>

